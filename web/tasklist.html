<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>å‡ºä»»å‹™ â€” ä»»å‹™åˆ—è¡¨</title>
    <style>
      :root {
        --bg: #f7f8fb;
        --card: #fff;
        --brand: #e53935;
        --accent: #4285f4;
        --muted: #666;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, "Noto Sans TC", sans-serif;
        background: var(--bg);
        color: #111;
      }
      .container {
        max-width: 1100px;
        margin: 0 auto;
        padding: 16px;
      }
      .topbar {
        background: #fff;
        border-bottom: 1px solid #e6e9ef;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
      }
      .topbar .container {
        display: flex;
        align-items: center;
        gap: 16px;
        height: 64px;
      }
      .brand {
        font-weight: 800;
        color: var(--brand);
        font-size: 20px;
      }
      .user-actions {
        display: flex;
        gap: 10px;
        align-items: center;
      }
      .primary {
        background: var(--brand);
        color: #fff;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
      }

      .layout {
        display: grid;
        grid-template-columns: 1fr 300px;
        gap: 20px;
        padding-top: 18px;
      }
      .left-col {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .filters {
        background: var(--card);
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #eef2f6;
      }
      .filter-row {
        display: flex;
        gap: 8px;
        margin-top: 8px;
      }
      .filter-row select {
        padding: 8px;
        border-radius: 6px;
        border: 1px solid #ddd;
      }

      .task-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .task {
        background: var(--card);
        padding: 14px;
        border-radius: 8px;
        border: 1px solid #eef2f6;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
      }
      .task-left {
        flex: 1;
      }
      .task .title {
        font-weight: 700;
        font-size: 16px;
        margin-bottom: 6px;
      }
      .meta-row {
        color: var(--muted);
        font-size: 13px;
        display: flex;
        gap: 12px;
        margin-bottom: 6px;
      }
      .desc {
        color: #333;
        line-height: 1.4;
      }

      .task-actions {
        display: flex;
        flex-direction: column;
        justify-content: center; /* å‚ç›´ç½®ä¸­ */
        gap: 8px;
        margin-left: 12px;
      }
      .task-actions .apply {
        background: #ff8a65;
        color: #fff;
        padding: 8px 12px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
      }
      .task-actions .fav {
        background: transparent;
        border: 1px solid #eee;
        padding: 6px;
        border-radius: 6px;
        cursor: pointer;
      }

      .right-col {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .tips-card {
        background: #fff;
        padding: 14px;
        border-radius: 8px;
        border: 1px solid #ffdce0;
      }
      .tips-card h3 {
        margin: 0 0 8px 0;
        color: #b71c1c;
      }
      .tips-card ol {
        padding-left: 18px;
        color: var(--muted);
      }
      .learn-more {
        display: inline-block;
        margin-top: 10px;
        color: var(--accent);
        font-weight: 600;
        text-decoration: none;
      }

      .stats-card {
        background: #fff;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #eef2f6;
      }
      .small {
        background: #f0f4ff;
        border: 1px solid #dfe8ff;
        padding: 8px 10px;
        border-radius: 6px;
        margin-right: 8px;
        cursor: pointer;
      }
      /* Modal èƒŒæ™¯é®ç½© */
      .modal {
        display: none; /* åˆå§‹éš±è— */
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6);
        z-index: 1000;
        justify-content: center;
        align-items: center;
        overflow: auto;
      }

      /* é¡¯ç¤ºæ™‚åŠ ä¸Šå‹•ç•« class */
      .modal.show {
        display: flex;
      }

      /* Modal å…§å®¹å®¹å™¨ï¼šå‹•ç•«åˆå§‹ç‹€æ…‹ */
      .modal-content {
        background-color: #fff;
        padding: 2rem;
        border-radius: 8px;
        max-width: 600px;
        width: 90%;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        position: relative;
        transform: translateY(50px);
        opacity: 0;
        transition: transform 0.4s ease, opacity 0.4s ease;
      }

      /* é¡¯ç¤ºå‹•ç•«ï¼šç”±ä¸‹å¾€ä¸Šæ·¡å…¥ */
      .modal.show .modal-content {
        transform: translateY(0);
        opacity: 1;
      }

      /* é—œé–‰å‹•ç•«ï¼šç”±ä¸Šå¾€ä¸‹æ·¡å‡º */
      .modal.hide .modal-content {
        transform: translateY(-50px);
        opacity: 0;
      }

      /* é—œé–‰æŒ‰éˆ• */
      .close-btn {
        position: absolute;
        top: 1rem;
        right: 1rem;
        font-size: 1.5rem;
        background: none;
        border: none;
        cursor: pointer;
      }

      /* å½ˆå‡ºå…§å®¹æ’ç‰ˆ */
      .task-field {
        margin-bottom: 1.5rem;
        font-size: 15px;
        color: #333;
      }
      .task-field strong {
        color: var(--brand);
      }
      .file-list {
        margin-top: 0.5rem;
        font-size: 0.9rem;
        color: #555;
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
      }
      .file-item {
        display: inline-block;
        width: 120px;
        padding: 6px;
        border: 1px solid #e6e9ef;
        border-radius: 6px;
        background: #fff;
        text-align: center;
        font-size: 12px;
        color: #333;
      }
      .file-item img {
        display: block;
        max-width: 100%;
        max-height: 80px;
        object-fit: cover;
        margin-bottom: 6px;
        border-radius: 4px;
      }
      .file-item .fname {
        display: block;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      /* æŒ‰éˆ•ç‹€æ…‹ */
      #confirmApplyBtn.active {
        background: #2e7d32; /* ç¶ è‰² */
        color: #fff;
      }
      #confirmApplyBtn.inactive {
        background: #cfcfcf; /* ç°è‰² */
        color: #666;
      }
      #confirmApplyBtn.loading {
        opacity: 0.9;
      }
      .fixed-header {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        background: #fff;
        border-bottom: 1px solid #ddd;
        z-index: 999;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
      }

      .header-container {
        display: flex;
        align-items: center;
        padding: 10px 16px;
      }

      .menu-btn {
        font-size: 20px;
        background: none;
        border: none;
        cursor: pointer;
        margin-right: 12px;
      }

      .brand {
        font-weight: bold;
        font-size: 18px;
        color: #e53935;
      }

      .menu-list {
        display: none;
        flex-direction: column;
        background: #f9f9f9;
        border-top: 1px solid #eee;
        padding: 10px 16px;
      }

      .menu-list.show {
        display: flex;
      }

      .menu-list a {
        text-decoration: none;
        color: #333;
        padding: 8px 0;
        font-size: 16px;
        border-bottom: 1px solid #eee;
      }

      .menu-list a:hover {
        color: #e53935;
      }
    </style>
  </head>
  <body>
    <header class="fixed-header">
      <div class="header-container">
        <button id="menuToggle" class="menu-btn">â˜°</button>
        <div class="brand">å‡ºä»»å‹™å¹³å°</div>
      </div>
      <nav id="menuList" class="menu-list">
        <a href="main.html">ğŸ  é¦–é </a>
        <a href="boss.html">ğŸ‘¤ ç™¼å‡ºæ¡ˆä»¶ç®¡ç†</a>
        <a href="tasker.html">âš™ï¸ æ‰¿æ¥ä»»å‹™ç®¡ç†</a>
      </nav>
    </header>
    <header class="topbar">
      <div class="container">
        <div class="brand">å‡ºä»»å‹™</div>

        <div class="user-actions">
          <div class="userid">T6205618</div>
        </div>
      </div>
    </header>

    <main class="container layout">
      <section class="left-col">
        <div class="filters">
          <div class="meta">
            <span id="total">å…± 0 ç­†ä»»å‹™</span>
          </div>
          <div class="filter-row">
            <select id="location">
              <option>å…¨éƒ¨åœ°å€</option>
            </select>
            <div style="display: flex; gap: 6px">
              <input
                id="priceMin"
                type="number"
                placeholder="æœ€ä½é‡‘é¡"
                style="width: 100px"
              />
              <input
                id="priceMax"
                type="number"
                placeholder="æœ€é«˜é‡‘é¡"
                style="width: 100px"
              />
            </div>
          </div>
        </div>

        <div id="taskList" class="task-list">
          <!-- ä»»å‹™é …ç›®ç”± JS æ¸²æŸ“ -->
        </div>
      </section>

      <aside class="right-col">
        <div class="tips-card">
          <h3>ä»»å‹™æŒ‡å— / Tips</h3>
          <ol>
            <li>å·¥ä½œå…§å®¹æ˜¯å¦æ¸…æ™°</li>
            <li>å·¥ä½œæ™‚é–“æ˜¯å¦åˆç†</li>
            <li>æ˜¯å¦æœ‰é¡å¤–è¦æ±‚ï¼ˆå¦‚å€‹è³‡ã€OTPï¼‰</li>
          </ol>
        </div>
      </aside>
    </main>

    <template id="taskTpl">
      <article class="task">
        <div class="task-left">
          <div class="title"></div>
          <div class="meta-row">
            <span class="reward"></span>
            <span class="deadline"></span>
            <span class="region"></span>
          </div>
          <p class="desc"></p>
        </div>
        <div class="task-actions">
          <button class="apply">æå‡ºæ‰¿åŒ…æ„é¡˜</button>
        </div>
      </article>
    </template>

    <div id="newTaskModal" class="modal" aria-hidden="true">
  <div class="modal-content">
    <button class="close-btn" id="closeNewTask">&times;</button>
    <h2>æ¡ˆä»¶è©³æƒ…</h2>
    <div class="task-field" style="background: #fff9f9; padding: 12px; border-radius: 8px; border: 1px solid #ffdce0; margin-bottom: 15px;">
  <div style="display: flex; align-items: center; gap: 8px;">
    <strong>ç™¼æ¡ˆäººä¿¡è­½ï¼š</strong>
    <span id="bossAvgScore" style="color: #f57c00; font-weight: bold;">è¼‰å…¥ä¸­...</span>
  </div>
  <div id="bossReviews" style="font-size: 13px; color: #666; margin-top: 8px; max-height: 100px; overflow-y: auto; background: #fff; padding: 8px; border-radius: 4px; border: 1px solid #eee;">
    ç­‰å¾…æŸ¥è©¢è©•åƒ¹...
  </div>
</div>
    <div class="task-field">
      <strong>æ¨™é¡Œï¼š</strong> <span id="taskTitle"></span> </div>
    <div class="task-field">
      <strong>é ç®—ï¼š</strong> <span id="taskBudget"></span> </div>
    <div class="task-field">
      <strong>åœ°å€ï¼š</strong> <span id="taskRegion"></span> </div>
    <div class="task-field">
      <strong>æˆªæ­¢æ—¥ï¼š</strong> <span id="taskClose"></span> </div>
    <div class="task-field">
      <strong>èªªæ˜ï¼š</strong>
      <p id="taskMeta"></p> </div>
    
    <div class="task-field" style="border-top: 1px dashed #ccc; padding-top: 15px;">
      <strong>ä¸Šå‚³ææ¡ˆè¨ˆç•«æ›¸ (PDF)ï¼š</strong>
      <input type="file" id="proposalFile" accept=".pdf" style="width: 100%; margin-top: 8px;">
    </div>

    <div class="task-field">
      <strong>é™„ä»¶æª”æ¡ˆï¼š</strong>
      <div id="taskFiles" class="file-list">â€”</div>
    </div>
    
    <div class="task-field" style="text-align: right">
      <button id="confirmApplyBtn" class="primary">âœ… é€å‡ºææ¡ˆ</button>
    </div>
  </div>
</div>

    <script>
  window.addEventListener("DOMContentLoaded", () => {
    // --- 1. å…ƒç´ é¸å–èˆ‡è®Šæ•¸åˆå§‹åŒ– ---
    const menuToggle = document.getElementById("menuToggle");
    const menuList = document.getElementById("menuList");
    const taskListEl = document.getElementById("taskList");
    const tpl = document.getElementById("taskTpl");
    const totalEl = document.getElementById("total");
    const locationSelect = document.getElementById("location");
    const priceMin = document.getElementById("priceMin");
    const priceMax = document.getElementById("priceMax");
    const modal = document.getElementById("newTaskModal");
    const closeBtn = document.getElementById("closeNewTask");
    const confirmApplyBtn = document.getElementById("confirmApplyBtn");
    const filesEl = document.getElementById("taskFiles");

    window.allTasks = [];
    window.currentUserId = ""; 

    // --- 2. è£œå›ï¼šå½ˆçª—é¡¯ç¤ºèˆ‡éš±è—å‡½å¼ ---

    // é¡¯ç¤ºä»»å‹™è©³æƒ…ä¸¦æº–å‚™ææ¡ˆ
async function showTaskInfo(task) {
    console.log("âœ… é€²å…¥ showTaskInfo, æº–å‚™è™•ç†ä»»å‹™:", task.id);

    const modal = document.getElementById("newTaskModal");
    if (!modal) return;

    // 1. å¡«å……åŸºæœ¬æ–‡å­— (ç¢ºä¿ ID æ­£ç¢º)
    const safeSetText = (id, val) => {
        const el = document.getElementById(id);
        if (el) el.textContent = val || "";
    };

    safeSetText("taskTitle", task.title);
    safeSetText("taskBudget", task.reward);
    safeSetText("taskRegion", task.region);
    safeSetText("taskMeta", task.desc);
    safeSetText("taskClose", formatTaiwanDatetime(task.deadline));

    // 2. é¡¯ç¤ºå½ˆçª—
    modal.classList.add("show");
    document.body.style.overflow = "hidden";
    
    // 3. è™•ç†é™„ä»¶é è¦½
    if (typeof renderAttachments === "function") {
        renderAttachments(task.attachments);
    }

    // --- é—œéµï¼šè™•ç†è©•åƒ¹é¡¯ç¤º ---
    const scoreEl = document.getElementById("bossAvgScore");
    const reviewsEl = document.getElementById("bossReviews");

    // é‡è¨­é¡¯ç¤ºç‹€æ…‹
    if (scoreEl) scoreEl.textContent = "è®€å–ä¸­...";
    if (reviewsEl) reviewsEl.innerHTML = "æ­£åœ¨è¼‰å…¥è©•åƒ¹...";

    // ç¢ºèªç™¼æ¡ˆäºº ID (æ ¹æ“šæ‚¨çš„è³‡æ–™åº«ï¼Œæ‡‰è©²æ˜¯ poster_id)
    const bossId = task.poster_id || task.user_id;
    console.log("ğŸ” æ­£åœ¨æŸ¥è©¢ç™¼æ¡ˆäºº ID:", bossId);

    if (!bossId) {
        if (scoreEl) scoreEl.textContent = "ç„¡ç™¼æ¡ˆäººè³‡è¨Š";
        if (reviewsEl) reviewsEl.innerHTML = "";
        return;
    }

    try {
        // ç™¼é€è«‹æ±‚åˆ°å¾Œç«¯
        const response = await fetch(`backend/get_user_rating.php?user_id=${bossId}`);
        const data = await response.json();
        console.log("ğŸ“¦ è©•åƒ¹ API å›å‚³çµæœ:", data);

        if (data.success && data.total_reviews > 0) {
            // é¡¯ç¤ºåˆ†æ•¸
            if (scoreEl) {
                scoreEl.textContent = `â­ ${parseFloat(data.average_score).toFixed(1)} (${data.total_reviews} å‰‡è©•åƒ¹)`;
            }
            // é¡¯ç¤ºè³ªæ€§æ„è¦‹
            if (reviewsEl) {
                if (data.reviews && data.reviews.length > 0) {
                    reviewsEl.innerHTML = data.reviews.map(r => 
                        `<div style="margin-bottom:8px; border-bottom:1px solid #eee; padding-bottom:5px;">
                            â€¢ ${r.comment ? r.comment : 'ï¼ˆåƒ…çµ¦åˆ†æœªç•™è¨€ï¼‰'}
                        </div>`
                    ).join("");
                } else {
                    reviewsEl.innerHTML = "ç›®å‰æš«ç„¡æ–‡å­—è©•åƒ¹ã€‚";
                }
            }
        } else {
            if (scoreEl) scoreEl.textContent = "å°šç„¡è©•åˆ†";
            if (reviewsEl) reviewsEl.innerHTML = "è©²ç™¼æ¡ˆäººç›®å‰é‚„æ²’æœ‰ä»»ä½•ç´€éŒ„ã€‚";
        }
    } catch (err) {
        console.error("âŒ Fetch Error:", err);
        if (scoreEl) scoreEl.textContent = "é€£ç·šå¤±æ•—";
        if (reviewsEl) reviewsEl.innerHTML = "ç„¡æ³•å–å¾—è©•åƒ¹è³‡è¨Šã€‚";
    }
}

    // éš±è—å½ˆçª—
    function hideTaskInfo() {
        modal.classList.remove("show");
        modal.setAttribute("aria-hidden", "true");
        document.body.style.overflow = "";
    }

    // --- 3. æ ¸å¿ƒåŠŸèƒ½ï¼šSession å–å¾—èˆ‡ä»»å‹™éæ¿¾ ---

    // å–å¾— Session è³‡æ–™ä¸¦åˆå§‹åŒ–é é¢
    async function initSessionAndLoad() {
        try {
            const res = await fetch("backend/get_session_user.php", { credentials: "same-origin" });
            if (!res.ok) throw new Error("ç„¡æ³•å–å¾— session");
            const data = await res.json();
            window.currentUserId = String(data.user_id || "");
            
            const idEl = document.querySelector(".userid");
            if (idEl) idEl.textContent = data.user_id ? `ID:${data.user_id}` : "ID:æœªç™»å…¥";

            await fetchTasks();
        } catch (err) {
            console.warn("å–å¾—ä½¿ç”¨è€…å¤±æ•—", err);
            await fetchTasks();
        }
    }

    // å¾å¾Œç«¯ç²å–ä»»å‹™
    async function fetchTasks() {
        try {
            const resp = await fetch("backend/get_tasks.php", { credentials: "same-origin" });
            if (!resp.ok) throw new Error("è¼‰å…¥å¤±æ•—");
            window.allTasks = await resp.json();
            applyFilters(); 
        } catch (err) {
            console.error("è¼‰å…¥ä»»å‹™å¤±æ•—", err);
        }
    }

    // ç¯©é¸é‚è¼¯ï¼šåŒ…å«éš±è—è‡ªå·±ç™¼å¸ƒèˆ‡å·²éæœŸçš„ä»»å‹™
    function applyFilters() {
        const region = locationSelect.value;
        const min = parseInt(priceMin.value, 10);
        const max = parseInt(priceMax.value, 10);
        const now = new Date().getTime();

        const filtered = window.allTasks.filter((t) => {
            const matchRegion = !region || region === "å…¨éƒ¨åœ°å€" || region === "ä¸é™" || t.region === region;
            const reward = parseFloat(t.reward.replace(/[^\d.]/g, ""));
            const matchMin = isNaN(min) || reward >= min;
            const matchMax = isNaN(max) || reward <= max;

            // éš±è—è‡ªå·±ç™¼å¸ƒçš„ä»»å‹™
            const isNotMine = !window.currentUserId || String(t.poster_id) !== String(window.currentUserId);

            // éš±è—å·²éæœŸçš„ä»»å‹™
            const taskDate = new Date(t.deadline);
            const isNotExpired = isNaN(taskDate.getTime()) || taskDate.getTime() > now;

            return matchRegion && matchMin && matchMax && isNotMine && isNotExpired;
        });
        renderTasks(filtered);
    }

    // --- 4. æ¸²æŸ“ã€é™„ä»¶è™•ç†èˆ‡é€å‡ºææ¡ˆ ---

    function renderTasks(items) {
        taskListEl.innerHTML = "";
        totalEl.textContent = `å…± ${items.length} ç­†ä»»å‹™`;

        if (!locationSelect.dataset.initialized) {
            const regions = [...new Set(window.allTasks.map(t => t.region).filter(Boolean))];
            locationSelect.innerHTML = `<option value="">å…¨éƒ¨åœ°å€</option><option value="ä¸é™">ä¸é™</option>` +
                regions.filter(r => r !== "ä¸é™").map(r => `<option value="${r}">${r}</option>`).join("");
            locationSelect.dataset.initialized = "true";
        }

        items.forEach((it) => {
            const node = tpl.content.cloneNode(true);
            node.querySelector(".title").textContent = it.title;
            node.querySelector(".reward").textContent = `å ±é…¬ï¼š${it.reward}`;
            node.querySelector(".deadline").textContent = `æˆªæ­¢ï¼š${formatTaiwanDatetime(it.deadline)}`;
            node.querySelector(".region").textContent = `åœ°å€ï¼š${it.region}`;
            node.querySelector(".desc").textContent = it.desc;
            node.querySelector(".apply").addEventListener("click", () => showTaskInfo(it));
            taskListEl.appendChild(node);
        });
    }

    function formatTaiwanDatetime(str) {
        return new Date(str).toLocaleString("zh-TW", {
            year: "numeric", month: "2-digit", day: "2-digit",
            hour: "2-digit", minute: "2-digit", second: "2-digit", hour12: true
        });
    }

    // è™•ç†é™„ä»¶é¡¯ç¤º
    function renderAttachments(rawAttachments) {
        filesEl.innerHTML = "";
        let attachments = [];
        try {
            attachments = (typeof rawAttachments === "string") ? 
                (rawAttachments.trim() ? JSON.parse(rawAttachments) : []) : (rawAttachments || []);
        } catch (e) { attachments = []; }

        if (!attachments.length) { filesEl.textContent = "â€”"; return; }

        attachments.forEach(f => {
            const item = document.createElement("div");
            item.className = "file-item";
            const name = f.orig_name || f.filename || "æª”æ¡ˆ";
            // æ¨™æº–åŒ–è·¯å¾‘é‚è¼¯å¯æ²¿ç”¨æ‚¨åŸæœ‰çš„ normalizeUrl
            const url = f.url || f.path || ""; 
            
            const link = document.createElement("a");
            link.href = url; link.textContent = "æŸ¥çœ‹"; link.target = "_blank";
            item.appendChild(link);

            const fname = document.createElement("span");
            fname.className = "fname"; fname.textContent = name;
            item.appendChild(fname);
            filesEl.appendChild(item);
        });
    }

    // ç›£è½ã€Œé€å‡ºææ¡ˆã€
    confirmApplyBtn.addEventListener("click", async () => {
        const fileInput = document.getElementById("proposalFile");
        const file = fileInput ? fileInput.files[0] : null;

        if (!file || file.type !== "application/pdf") {
            alert("è«‹å…ˆé¸æ“‡ä¸€ä»½ PDF æ ¼å¼çš„è¨ˆç•«æ›¸");
            return;
        }

        confirmApplyBtn.disabled = true;
        confirmApplyBtn.textContent = "ä¸Šå‚³ä¸­...";

        const formData = new FormData();
        formData.append("task_id", modal.dataset.taskId);
        formData.append("proposal_pdf", file);

        try {
            const resp = await fetch("backend/apply_intent.php", {
                method: "POST",
                body: formData,
                credentials: "same-origin"
            });
            const result = await resp.json();
            if (result.success) {
                alert("âœ… ææ¡ˆå·²é€å‡ºï¼");
                hideTaskInfo();
            } else {
                alert("âŒ å¤±æ•—ï¼š" + (result.message || "æœªçŸ¥éŒ¯èª¤"));
            }
        } catch (err) {
            alert("âš ï¸ ç¶²è·¯éŒ¯èª¤");
        } finally {
            confirmApplyBtn.disabled = false;
            confirmApplyBtn.textContent = "âœ… é€å‡ºææ¡ˆ";
        }
    });

    // --- 5. äº‹ä»¶ç›£è½ ---
    closeBtn.addEventListener("click", hideTaskInfo);
    modal.addEventListener("click", (e) => e.target === modal && hideTaskInfo());
    document.addEventListener("keydown", (e) => e.key === "Escape" && hideTaskInfo());
    
    locationSelect.addEventListener("change", applyFilters);
    priceMin.addEventListener("input", applyFilters);
    priceMax.addEventListener("input", applyFilters);
    menuToggle.addEventListener("click", () => menuList.classList.toggle("show"));

    // å•Ÿå‹•æµç¨‹
    initSessionAndLoad();
});
</script>
  </body>
</html>
