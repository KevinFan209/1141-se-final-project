<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>å‡ºä»»å‹™ â€” ä»»å‹™åˆ—è¡¨</title>
    <style>
      :root {
        --bg: #f7f8fb;
        --card: #fff;
        --brand: #e53935;
        --accent: #4285f4;
        --muted: #666;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, "Noto Sans TC", sans-serif;
        background: var(--bg);
        color: #111;
      }
      .container {
        max-width: 1100px;
        margin: 0 auto;
        padding: 16px;
      }
      .topbar {
        background: #fff;
        border-bottom: 1px solid #e6e9ef;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
      }
      .topbar .container {
        display: flex;
        align-items: center;
        gap: 16px;
        height: 64px;
      }
      .brand {
        font-weight: 800;
        color: var(--brand);
        font-size: 20px;
      }
      .user-actions {
        display: flex;
        gap: 10px;
        align-items: center;
      }
      .primary {
        background: var(--brand);
        color: #fff;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
      }

      .layout {
        display: grid;
        grid-template-columns: 1fr 300px;
        gap: 20px;
        padding-top: 18px;
      }
      .left-col {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .filters {
        background: var(--card);
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #eef2f6;
      }
      .filter-row {
        display: flex;
        gap: 8px;
        margin-top: 8px;
      }
      .filter-row select {
        padding: 8px;
        border-radius: 6px;
        border: 1px solid #ddd;
      }

      .task-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .task {
        background: var(--card);
        padding: 14px;
        border-radius: 8px;
        border: 1px solid #eef2f6;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
      }
      .task-left {
        flex: 1;
      }
      .task .title {
        font-weight: 700;
        font-size: 16px;
        margin-bottom: 6px;
      }
      .meta-row {
        color: var(--muted);
        font-size: 13px;
        display: flex;
        gap: 12px;
        margin-bottom: 6px;
      }
      .desc {
        color: #333;
        line-height: 1.4;
      }

      .task-actions {
        display: flex;
        flex-direction: column;
        justify-content: center; /* å‚ç›´ç½®ä¸­ */
        gap: 8px;
        margin-left: 12px;
      }
      .task-actions .apply {
        background: #ff8a65;
        color: #fff;
        padding: 8px 12px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
      }
      .task-actions .fav {
        background: transparent;
        border: 1px solid #eee;
        padding: 6px;
        border-radius: 6px;
        cursor: pointer;
      }

      .right-col {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .tips-card {
        background: #fff;
        padding: 14px;
        border-radius: 8px;
        border: 1px solid #ffdce0;
      }
      .tips-card h3 {
        margin: 0 0 8px 0;
        color: #b71c1c;
      }
      .tips-card ol {
        padding-left: 18px;
        color: var(--muted);
      }
      .learn-more {
        display: inline-block;
        margin-top: 10px;
        color: var(--accent);
        font-weight: 600;
        text-decoration: none;
      }

      .stats-card {
        background: #fff;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #eef2f6;
      }
      .small {
        background: #f0f4ff;
        border: 1px solid #dfe8ff;
        padding: 8px 10px;
        border-radius: 6px;
        margin-right: 8px;
        cursor: pointer;
      }
      /* Modal èƒŒæ™¯é®ç½© */
      .modal {
        display: none; /* åˆå§‹éš±è— */
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6);
        z-index: 1000;
        justify-content: center;
        align-items: center;
        overflow: auto;
      }

      /* é¡¯ç¤ºæ™‚åŠ ä¸Šå‹•ç•« class */
      .modal.show {
        display: flex;
      }

      /* Modal å…§å®¹å®¹å™¨ï¼šå‹•ç•«åˆå§‹ç‹€æ…‹ */
      .modal-content {
        background-color: #fff;
        padding: 2rem;
        border-radius: 8px;
        max-width: 600px;
        width: 90%;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        position: relative;
        transform: translateY(50px);
        opacity: 0;
        transition: transform 0.4s ease, opacity 0.4s ease;
      }

      /* é¡¯ç¤ºå‹•ç•«ï¼šç”±ä¸‹å¾€ä¸Šæ·¡å…¥ */
      .modal.show .modal-content {
        transform: translateY(0);
        opacity: 1;
      }

      /* é—œé–‰å‹•ç•«ï¼šç”±ä¸Šå¾€ä¸‹æ·¡å‡º */
      .modal.hide .modal-content {
        transform: translateY(-50px);
        opacity: 0;
      }

      /* é—œé–‰æŒ‰éˆ• */
      .close-btn {
        position: absolute;
        top: 1rem;
        right: 1rem;
        font-size: 1.5rem;
        background: none;
        border: none;
        cursor: pointer;
      }

      /* å½ˆå‡ºå…§å®¹æ’ç‰ˆ */
      .task-field {
        margin-bottom: 1.5rem;
        font-size: 15px;
        color: #333;
      }
      .task-field strong {
        color: var(--brand);
      }
      .file-list {
        margin-top: 0.5rem;
        font-size: 0.9rem;
        color: #555;
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
      }
      .file-item {
        display: inline-block;
        width: 120px;
        padding: 6px;
        border: 1px solid #e6e9ef;
        border-radius: 6px;
        background: #fff;
        text-align: center;
        font-size: 12px;
        color: #333;
      }
      .file-item img {
        display: block;
        max-width: 100%;
        max-height: 80px;
        object-fit: cover;
        margin-bottom: 6px;
        border-radius: 4px;
      }
      .file-item .fname {
        display: block;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      /* æŒ‰éˆ•ç‹€æ…‹ */
      #confirmApplyBtn.active {
        background: #2e7d32; /* ç¶ è‰² */
        color: #fff;
      }
      #confirmApplyBtn.inactive {
        background: #cfcfcf; /* ç°è‰² */
        color: #666;
      }
      #confirmApplyBtn.loading {
        opacity: 0.9;
      }
      .fixed-header {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        background: #fff;
        border-bottom: 1px solid #ddd;
        z-index: 999;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
      }

      .header-container {
        display: flex;
        align-items: center;
        padding: 10px 16px;
      }

      .menu-btn {
        font-size: 20px;
        background: none;
        border: none;
        cursor: pointer;
        margin-right: 12px;
      }

      .brand {
        font-weight: bold;
        font-size: 18px;
        color: #e53935;
      }

      .menu-list {
        display: none;
        flex-direction: column;
        background: #f9f9f9;
        border-top: 1px solid #eee;
        padding: 10px 16px;
      }

      .menu-list.show {
        display: flex;
      }

      .menu-list a {
        text-decoration: none;
        color: #333;
        padding: 8px 0;
        font-size: 16px;
        border-bottom: 1px solid #eee;
      }

      .menu-list a:hover {
        color: #e53935;
      }
    </style>
  </head>
  <body>
    <header class="fixed-header">
      <div class="header-container">
        <button id="menuToggle" class="menu-btn">â˜°</button>
        <div class="brand">å‡ºä»»å‹™å¹³å°</div>
      </div>
      <nav id="menuList" class="menu-list">
        <a href="main.html">ğŸ  é¦–é </a>
        <a href="boss.html">ğŸ‘¤ ç™¼å‡ºæ¡ˆä»¶ç®¡ç†</a>
        <a href="tasker.html">âš™ï¸ æ‰¿æ¥ä»»å‹™ç®¡ç†</a>
      </nav>
    </header>
    <header class="topbar">
      <div class="container">
        <div class="brand">å‡ºä»»å‹™</div>

        <div class="user-actions">
          <div class="userid">T6205618</div>
        </div>
      </div>
    </header>

    <main class="container layout">
      <section class="left-col">
        <div class="filters">
          <div class="meta">
            <span id="total">å…± 0 ç­†ä»»å‹™</span>
          </div>
          <div class="filter-row">
            <select id="location">
              <option>å…¨éƒ¨åœ°å€</option>
            </select>
            <div style="display: flex; gap: 6px">
              <input
                id="priceMin"
                type="number"
                placeholder="æœ€ä½é‡‘é¡"
                style="width: 100px"
              />
              <input
                id="priceMax"
                type="number"
                placeholder="æœ€é«˜é‡‘é¡"
                style="width: 100px"
              />
            </div>
          </div>
        </div>

        <div id="taskList" class="task-list">
          <!-- ä»»å‹™é …ç›®ç”± JS æ¸²æŸ“ -->
        </div>
      </section>

      <aside class="right-col">
        <div class="tips-card">
          <h3>ä»»å‹™æŒ‡å— / Tips</h3>
          <ol>
            <li>å·¥ä½œå…§å®¹æ˜¯å¦æ¸…æ™°</li>
            <li>å·¥ä½œæ™‚é–“æ˜¯å¦åˆç†</li>
            <li>æ˜¯å¦æœ‰é¡å¤–è¦æ±‚ï¼ˆå¦‚å€‹è³‡ã€OTPï¼‰</li>
          </ol>
        </div>
      </aside>
    </main>

    <template id="taskTpl">
      <article class="task">
        <div class="task-left">
          <div class="title"></div>
          <div class="meta-row">
            <span class="reward"></span>
            <span class="deadline"></span>
            <span class="region"></span>
          </div>
          <p class="desc"></p>
        </div>
        <div class="task-actions">
          <button class="apply">æå‡ºæ‰¿åŒ…æ„é¡˜</button>
        </div>
      </article>
    </template>

    <div id="newTaskModal" class="modal" aria-hidden="true">
      <div class="modal-content">
        <button class="close-btn" id="closeNewTask">&times;</button>
        <h2>æ¡ˆä»¶è©³æƒ…</h2>
        <div class="task-field">
          <strong>æ¨™é¡Œï¼š</strong> <span id="taskTitle"></span>
        </div>
        <div class="task-field">
          <strong>é ç®—ï¼š</strong> <span id="taskBudget"></span>
        </div>
        <div class="task-field">
          <strong>åœ°å€ï¼š</strong> <span id="taskRegion"></span>
        </div>
        <div class="task-field">
          <strong>æˆªæ­¢æ—¥ï¼š</strong> <span id="taskClose"></span>
        </div>
        <div class="task-field">
          <strong>èªªæ˜ï¼š</strong>
          <p id="taskMeta"></p>
        </div>
        <div class="task-field">
          <strong>é™„åŠ æª”æ¡ˆï¼š</strong>
          <div id="taskFiles" class="file-list">â€”</div>
        </div>
        <div class="task-field" style="text-align: right">
          <button id="confirmApplyBtn" class="primary">âœ… æå‡ºæ‰¿åŒ…æ„é¡˜</button>
        </div>
      </div>
    </div>

    <script>
      window.addEventListener("DOMContentLoaded", () => {
        const menuToggle = document.getElementById("menuToggle");
        const menuList = document.getElementById("menuList");

        menuToggle.addEventListener("click", () => {
          menuList.classList.toggle("show");
        });
        document.addEventListener("click", (e) => {
          const menuList = document.getElementById("menuList");
          const menuToggle = document.getElementById("menuToggle");

          // å¦‚æœå°è¦½åˆ—æ˜¯å±•é–‹ç‹€æ…‹ï¼Œä¸”é»æ“Šçš„ä¸æ˜¯å°è¦½åˆ—æˆ–æŒ‰éˆ•æœ¬èº«
          if (
            menuList.classList.contains("show") &&
            !menuList.contains(e.target) &&
            !menuToggle.contains(e.target)
          ) {
            menuList.classList.remove("show");
          }
        });

        const taskListEl = document.getElementById("taskList");
        const tpl = document.getElementById("taskTpl");
        const totalEl = document.getElementById("total");
        const locationSelect = document.getElementById("location");
        const priceMin = document.getElementById("priceMin");
        const priceMax = document.getElementById("priceMax");
        const modal = document.getElementById("newTaskModal");
        const closeBtn = document.getElementById("closeNewTask");

        const confirmApplyBtn = document.getElementById("confirmApplyBtn");

        confirmApplyBtn.addEventListener("click", async () => {
          // è‹¥æŒ‰éˆ•ç‚º inactiveï¼ˆè¡¨ç¤ºå·²æå‡ºï¼‰ï¼Œä½†é‚„æ˜¯å…è¨±é€å‡ºä»¥åˆ‡æ›ï¼ˆæˆ–ä½ å¯é˜»æ­¢ï¼‰
          if (confirmApplyBtn.disabled) return;

          const taskId = modal.dataset.taskId;
          // loading æ¨£å¼èˆ‡é–å®šæŒ‰éˆŸï¼Œé¿å…é‡è¤‡é»æ“Š
          confirmApplyBtn.disabled = true;
          confirmApplyBtn.classList.add("loading");

          try {
            const resp = await fetch("backend/apply_intent.php", {
              method: "POST",
              headers: { "Content-Type": "application/x-www-form-urlencoded" },
              body: `task_id=${encodeURIComponent(taskId)}`,
              credentials: "same-origin",
            });

            const result = await resp.json();

            confirmApplyBtn.classList.remove("loading");
            confirmApplyBtn.disabled = false;

            if (result.success) {
              if (result.action === "added") {
                // è®Šæˆå·²æå‡ºï¼ˆç°è‰²ï¼‰
                confirmApplyBtn.classList.remove("active");
                confirmApplyBtn.classList.add("inactive");
                confirmApplyBtn.textContent = "âŒ å·²æå‡ºï¼ˆå–æ¶ˆï¼‰";
              } else if (result.action === "removed") {
                // å°šæœªæå‡ºï¼ˆç¶ è‰²ï¼‰
                confirmApplyBtn.classList.remove("inactive");
                confirmApplyBtn.classList.add("active");
                confirmApplyBtn.textContent = "âœ… æå‡ºæ‰¿åŒ…æ„é¡˜";
              }
            } else {
              alert("âŒ æ“ä½œå¤±æ•—ï¼š" + (result.message || "æœªçŸ¥éŒ¯èª¤"));
            }
          } catch (err) {
            confirmApplyBtn.classList.remove("loading");
            confirmApplyBtn.disabled = false;
            console.error("æ„é¡˜åˆ‡æ›éŒ¯èª¤", err);
            alert("âš ï¸ ç¶²è·¯éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦");
          }
        });

        function hideTaskInfo() {
          modal.classList.remove("show");
          modal.setAttribute("aria-hidden", "true");
          document.body.style.overflow = "";
        }

        function showTaskInfo(task) {
          modal.dataset.taskId = task.id;
          // é¡¯ç¤º modal
          modal.classList.add("show");
          modal.setAttribute("aria-hidden", "false");
          document.body.style.overflow = "hidden";

          document.getElementById("taskTitle").textContent = task.title || "";
          document.getElementById("taskBudget").textContent = task.reward || "";
          document.getElementById("taskRegion").textContent = task.region || "";
          document.getElementById("taskMeta").textContent = task.desc || "";
          document.getElementById("taskClose").textContent =
            formatTaiwanDatetime(task.deadline);

          const filesEl = document.getElementById("taskFiles");
          filesEl.innerHTML = "";

          console.log("showTaskInfo called, task:", task);

          // åˆå§‹åŒ–æŒ‰éˆ•
          confirmApplyBtn.classList.remove("inactive", "active", "loading");
          confirmApplyBtn.disabled = true;
          confirmApplyBtn.textContent = "è¼‰å…¥ä¸­...";
          confirmApplyBtn.classList.add("loading");

          // æŸ¥è©¢å¾Œç«¯æ˜¯å¦å·²æå‡º
          fetch(`backend/check_intent.php?task_id=${task.id}`, {
            credentials: "same-origin",
          })
            .then((res) => res.json())
            .then((data) => {
              confirmApplyBtn.classList.remove("loading");
              confirmApplyBtn.disabled = false;
              if (data.hasIntent) {
                // å·²æå‡ºï¼šç°è‰² + é¡¯ç¤ºå–æ¶ˆ
                confirmApplyBtn.classList.add("inactive");
                confirmApplyBtn.textContent = "âŒ å·²æå‡ºï¼ˆå–æ¶ˆï¼‰";
              } else {
                // å°šæœªæå‡ºï¼šç¶ è‰² + é¡¯ç¤ºæå‡º
                confirmApplyBtn.classList.add("active");
                confirmApplyBtn.textContent = "âœ… æå‡ºæ‰¿åŒ…æ„é¡˜";
              }
            })
            .catch(() => {
              // å‡ºéŒ¯æ™‚å…è¨±å˜—è©¦ï¼ˆä¿å®ˆè™•ç†ï¼‰
              confirmApplyBtn.classList.remove("loading");
              confirmApplyBtn.disabled = false;
              confirmApplyBtn.classList.add("active");
              confirmApplyBtn.textContent = "âœ… æå‡ºæ‰¿åŒ…æ„é¡˜";
            });

          // è§£æ attachments
          let attachments = [];
          try {
            if (typeof task.attachments === "string") {
              attachments = task.attachments.trim()
                ? JSON.parse(task.attachments)
                : [];
            } else if (Array.isArray(task.attachments)) {
              attachments = task.attachments;
            } else {
              attachments = [];
            }
          } catch (err) {
            console.warn("é™„ä»¶è§£æå¤±æ•—", err, task.attachments);
            attachments = [];
          }
          console.log("parsed attachments:", attachments);

          if (!attachments || attachments.length === 0) {
            filesEl.textContent = "â€”";
            return;
          }

          // helper: ä¸æ”¹è®Šå·²ç‚ºå®Œæ•´è·¯å¾‘çš„ urlï¼›è‹¥åªæœ‰æª”åæˆ–ç›¸å°è·¯å¾‘å‰‡ä¸å¼·åˆ¶è£œå‰ç¶´ï¼ˆé¿å…é‡è¤‡ï¼‰
          const normalize = (f) => {
            let url = f.url || f.path || f.file_name || f.filename || "";
            if (!url) return null;
            url = String(url).replace(/\\/g, "/").trim();

            // å¦‚æœå·²ç¶“æ˜¯å®Œæ•´çµ•å°è·¯å¾‘ï¼ˆå¾æ ¹ç›®éŒ„é–‹å§‹ï¼‰ï¼Œç›´æ¥å›å‚³
            if (url.startsWith("/")) return url;

            // è‹¥æ˜¯çœ‹èµ·ä¾†åƒå·²å« uploads ç‰‡æ®µï¼ˆä½†ç¼ºé–‹é ­æ–œç·šï¼‰ï¼Œè£œä¸€å€‹æ–œç·š
            if (url.match(/^web\/|^backend\/|^uploads\//i)) {
              return "/" + url.replace(/^\/+/, "");
            }

            // æœ€å¾Œä¿å®ˆè™•ç†ï¼šç•¶ä½œæ”¾åœ¨ uploads ä¸‹çš„æª”åï¼ˆè‹¥ä½ çš„ç’°å¢ƒä¸æ˜¯é€™å€‹ï¼Œè«‹æ”¹æˆåˆé©çš„å‰ç¶´ï¼‰
            return "/web/backend/uploads/" + url.replace(/^\/+/, "");
          };

          attachments.forEach((f, idx) => {
            const item = document.createElement("div");
            item.className = "file-item";

            const name = f.orig_name || f.filename || f.file_name || "æª”æ¡ˆ";
            const url = normalize(f);
            console.log(`attachment[${idx}] raw:`, f, "normalized:", url);

            const isImage =
              (f.mime && String(f.mime).toLowerCase().startsWith("image/")) ||
              (url && url.match(/\.(png|jpe?g|gif|bmp|webp|svg)$/i));

            if (isImage && url) {
              const img = document.createElement("img");
              img.alt = name;
              img.src = url;
              // å†æ¬¡ç¢ºèªåœ–ç‰‡è¼‰å…¥çµæœ
              img.addEventListener("error", (e) => {
                console.warn("image load error for", url, e);
                // è‹¥è¼‰å…¥å¤±æ•—ï¼Œå¯é¡¯ç¤ºæ›¿ä»£æ–‡å­—æˆ–ä¸‹è¼‰é€£çµ
                item.innerHTML = `<div style="color:#a00;font-size:12px">åœ–ç‰‡è¼‰å…¥å¤±æ•—</div>`;
              });
              img.addEventListener("load", () => {
                console.log("image loaded:", url);
              });
              item.appendChild(img);
            } else if (url) {
              const link = document.createElement("a");
              link.href = url;
              link.textContent = "ä¸‹è¼‰";
              link.target = "_blank";
              link.style.display = "block";
              item.appendChild(link);
            } else {
              const no = document.createElement("div");
              no.style.color = "#999";
              no.textContent = "ç„¡å¯ç”¨é€£çµ";
              item.appendChild(no);
            }

            const fname = document.createElement("span");
            fname.className = "fname";
            fname.textContent = name;
            item.appendChild(fname);

            filesEl.appendChild(item);
          });
        }

        closeBtn.addEventListener("click", hideTaskInfo);

        modal.addEventListener("click", (e) => {
          if (e.target === modal) hideTaskInfo();
        });

        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape" && modal.classList.contains("show")) {
            hideTaskInfo();
          }
        });

        async function fetchTasks() {
          try {
            const resp = await fetch("backend/get_tasks.php", {
              credentials: "same-origin",
            });
            if (!resp.ok) throw new Error("è¼‰å…¥å¤±æ•—");

            const data = await resp.json();
            window.allTasks = data;
            renderTasks(data);
          } catch (err) {
            console.error("è¼‰å…¥ä»»å‹™å¤±æ•—", err);
            alert("ç„¡æ³•è¼‰å…¥ä»»å‹™ï¼Œè«‹ç¨å¾Œå†è©¦");
          }
        }

        function applyFilters() {
          const region = locationSelect.value;
          const min = parseInt(priceMin.value, 10);
          const max = parseInt(priceMax.value, 10);

          const filtered = window.allTasks.filter((t) => {
            const matchRegion =
              region === "" || region === "ä¸é™" || t.region === region;
            const matchKeyword =
              !keyword ||
              t.title.toLowerCase().includes(keyword) ||
              t.desc.toLowerCase().includes(keyword);

            const rewardStr = t.reward.replace(/[^\d.]/g, "");
            const reward = parseFloat(rewardStr);

            const matchMin = isNaN(min) || reward >= min;
            const matchMax = isNaN(max) || reward <= max;

            return matchRegion && matchKeyword && matchMin && matchMax;
          });

          renderTasks(filtered);
        }

        function formatTaiwanDatetime(datetimeStr) {
          const date = new Date(datetimeStr);
          return date.toLocaleString("zh-TW", {
            year: "numeric",
            month: "2-digit",
            day: "2-digit",
            hour: "2-digit",
            minute: "2-digit",
            second: "2-digit",
            hour12: true,
          });
        }

        function renderTasks(items) {
          taskListEl.innerHTML = "";
          totalEl.textContent = `å…± ${items.length} ç­†ä»»å‹™`;

          const uniqueRegions = [
            ...new Set(window.allTasks.map((t) => t.region).filter(Boolean)),
          ];

          if (!locationSelect.dataset.initialized) {
            locationSelect.innerHTML =
              `<option value="">å…¨éƒ¨åœ°å€</option><option value="ä¸é™">ä¸é™</option>` +
              uniqueRegions
                .filter((r) => r !== "ä¸é™")
                .map((r) => `<option value="${r}">${r}</option>`)
                .join("");
            locationSelect.dataset.initialized = "true";
          }

          items.forEach((it) => {
            const node = tpl.content.cloneNode(true);
            node.querySelector(".title").textContent = it.title;
            node.querySelector(".reward").textContent = `å ±é…¬ï¼š${it.reward}`;
            node.querySelector(
              ".deadline"
            ).textContent = `æˆªæ­¢ï¼š${formatTaiwanDatetime(it.deadline)}`;
            node.querySelector(".region").textContent = `åœ°å€ï¼š${it.region}`;
            node.querySelector(".desc").textContent = it.desc;

            const posterInfo = document.createElement("div");
            posterInfo.className = "meta-row";
            posterInfo.textContent = `ç™¼ä½ˆè€… IDï¼š${it.poster_id}`;
            node.querySelector(".task-left").appendChild(posterInfo);

            node.querySelector(".apply").addEventListener("click", () => {
              showTaskInfo(it);
            });

            taskListEl.appendChild(node);
          });
        }

        locationSelect.addEventListener("change", applyFilters);
        priceMin.addEventListener("input", applyFilters);
        priceMax.addEventListener("input", applyFilters);

        fetchTasks();
      });
    </script>
  </body>
</html>
