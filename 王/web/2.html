<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <title>專案列表</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
      /* === 全域樣式 === */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: "Noto Sans TC", sans-serif;
      }
      body {
        background: #f5f5f5;
        color: #333;
      }

      /* === 主容器 === */
      .container {
        display: grid;
        grid-template-columns: 200px 1fr;
        gap: 16px;
        max-width: 1200px;
        margin: 32px auto;
        padding: 0 16px;
      }

      /* === 地區分類側欄 === */
      .region-filter {
        background: #2f8fbf;
        color: white;
        border-radius: 8px;
        padding: 16px;
        height: fit-content;
      }
      .region-filter h2 {
        font-size: 18px;
        margin-bottom: 12px;
      }
      .region-list {
        list-style: none;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .region-list button {
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
      }
      .region-list button.active {
        background: rgba(255, 255, 255, 0.2);
      }

      /* === 主內容區 === */
      .main-content {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      /* === 搜尋框 === */
      .search-bar {
        display: flex;
        gap: 8px;
      }
      .search-bar input {
        flex: 1;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 16px;
      }
      .search-bar button {
        padding: 10px 16px;
        border: none;
        background: #9feaf9;
        color: #033;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
      }

      /* === 專案列表 === */
      .project-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .project-card {
        background: white;
        border-radius: 8px;
        padding: 16px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .project-title {
        font-size: 18px;
        font-weight: bold;
        color: #0b3e3e;
      }
      .project-meta {
        font-size: 14px;
        color: #666;
      }
      .project-desc {
        font-size: 14px;
        color: #444;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- === 地區分類 === -->
      <aside class="region-filter">
        <h2>地區分類</h2>
        <ul class="region-list" id="regionList">
          <li><button data-region="全部" class="active">全部</button></li>
          <li><button data-region="宜蘭縣">宜蘭縣</button></li>
          <li><button data-region="台北市">台北市</button></li>
          <li><button data-region="新北市">新北市</button></li>
          <li><button data-region="基隆縣">基隆縣</button></li>
          <li><button data-region="桃園市">桃園市</button></li>
          <li><button data-region="新竹縣">新竹縣</button></li>
          <li><button data-region="苗栗縣">苗栗縣</button></li>
          <li><button data-region="台中市">台中市</button></li>
          <li><button data-region="彰化縣">彰化縣</button></li>
          <li><button data-region="南投縣">南投縣</button></li>
          <li><button data-region="雲林縣">雲林縣</button></li>
          <li><button data-region="嘉義縣">嘉義縣</button></li>
          <li><button data-region="台南市">台南市</button></li>
          <li><button data-region="高雄市">高雄市</button></li>
          <li><button data-region="屏東縣">屏東縣</button></li>
          <li><button data-region="花蓮縣">花蓮縣</button></li>
          <li><button data-region="台東縣">台東縣</button></li>
          <li><button data-region="其他">其他</button></li>
          <!-- 可依需求加入其他縣市 -->
        </ul>
      </aside>

      <!-- === 主內容區 === -->
      <main class="main-content">
        <!-- === 搜尋框 === -->
        <div class="search-bar">
          <input
            type="text"
            id="searchInput"
            placeholder="輸入專案名稱關鍵字"
          />
          <button id="searchBtn">搜尋</button>
        </div>

        <!-- === 專案列表 === -->
        <div class="project-list" id="projectList">
          <!-- JS 動態插入專案卡片 -->
        </div>
      </main>
    </div>

    <script>
function escapeHtml(s){
  if(!s) return '';
  return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
}

function renderProjects(keyword = '') {
  fetch('projects.php')
    .then(res => res.json())
    .then(data => {
      const list = document.getElementById('projectList');
      list.innerHTML = '';

      const filtered = data.filter(p => {
        const matchRegion = currentRegion === '全部' || p.region === currentRegion;
        const matchKeyword = !keyword || p.title.toLowerCase().includes(keyword.toLowerCase());
        return matchRegion && matchKeyword;
      });

      if (filtered.length === 0) {
        list.innerHTML = '<div style="padding:12px;color:#666">目前沒有符合條件的專案</div>';
        return;
      }

      for (const p of filtered) {
        const card = document.createElement('div');
        card.className = 'project-card';

        // 附件縮圖
        let attachmentsHtml = '';
        if (Array.isArray(p.attachments) && p.attachments.length > 0) {
          attachmentsHtml = '<div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:6px">';
          for (const a of p.attachments.slice(0,3)) {
            const ext = (a.filename || '').split('.').pop().toLowerCase();
            if (['jpg','jpeg','png','gif','webp'].includes(ext)) {
              attachmentsHtml += `<img src="${escapeHtml(a.path)}" alt="${escapeHtml(a.filename)}" style="width:60px;height:40px;object-fit:cover;border-radius:6px;border:1px solid #ccc">`;
            } else {
              attachmentsHtml += `<div style="padding:6px 10px;background:#eee;border-radius:6px;font-size:12px">${escapeHtml(ext.toUpperCase())}</div>`;
            }
          }
          attachmentsHtml += '</div>';
        }

        // 展開詳情區塊
        const detailId = 'detail-' + p.id;
        card.innerHTML = `
          <div class="project-title">${escapeHtml(p.title)}</div>
          <div class="project-meta">地區：${escapeHtml(p.region)} · 預算：${escapeHtml(p.budget)} · 發案日：${escapeHtml(p.created_at)}</div>
          <button onclick="toggleDetail('${detailId}')" style="margin-top:6px;padding:6px 10px;border:none;background:#2f8fbf;color:white;border-radius:6px;cursor:pointer">展開詳情</button>
          <div id="${detailId}" style="display:none;margin-top:8px">
            <div class="project-desc">${escapeHtml(p.description || '')}</div>
            ${attachmentsHtml}
          </div>
        `;
        list.appendChild(card);
      }
    })
    .catch(err => {
      console.error('載入失敗', err);
      document.getElementById('projectList').innerHTML = '<div style="color:red;padding:12px">資料載入失敗，請稍後再試</div>';
    });
}

function toggleDetail(id) {
  const el = document.getElementById(id);
  if (el) el.style.display = el.style.display === 'none' ? 'block' : 'none';
}
</script>

  </body>
</html>
